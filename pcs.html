<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PCS Sandbox</title>
</head>
<body>

<canvas id="test_canvas"></canvas>

  <script src="collections.js"></script>
  <script src="geometry.js"></script>
  <script src="data_models.js"></script>
  <script src="diagrams.js"></script>
  <script src="vector_math.js"></script>
  <script src="shape_editors.js"></script>
  <script src="statecharts.js"></script>
  <script src="third_party/clipper.js"></script>

<script type="text/javascript" language="JavaScript">
'use strict';

var canvas = document.getElementById('test_canvas');
var ctx = canvas.getContext('2d');

document.bgColor = '#6666cc';

var canvasController = new diagrams.CanvasController(canvas, ctx),
    statechartModel = { root: statechart_data },
    shapeModel = { root: shape_data };

canvasController.theme = diagrams.theme.createBlueprint();

var onUpdate = function() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  canvasController.draw();
}

var statechartEditor = new statecharts.Editor(statechartModel, onUpdate),
    shapeEditor = new shapes.Editor(shapeModel, onUpdate);

var editorName = 'statecharts',
    editor;

function startEditor() {
  switch (editorName) {
    case 'statecharts':
      editor = statechartEditor;
      break;
    case 'shapes':
      editor = shapeEditor;
      break;
  }

  canvasController.configure([editor]);
  onUpdate();
}

startEditor();

function resizeCanvas() {
  diagrams.resizeCanvas(canvas, window.innerWidth, window.innerHeight);
  onUpdate();
}

resizeCanvas();

window.onresize = resizeCanvas;

canvas.onmousedown = function(e) {
  canvasController.onMouseDown(e);
};

canvas.onmousemove = function(e) {
  canvasController.onMouseMove(e);
};

canvas.onmouseup = function(e) {
  canvasController.onMouseUp(e);
};

canvas.ondblclick = function(e) {
  editorName = (editorName == 'statecharts' ? 'shapes' : 'statecharts');
  startEditor();
}

document.onkeydown = function(e) {
  editor.onKeyDown(e);
}

document.onkeyup = function(e) {
  editor.onKeyUp(e);
}

</script>

</body>
</html>